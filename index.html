<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Pendaftaran Wajah - Gemini + Firestore</title>
</head>
<body>
    <h1>Pendaftaran Wajah</h1>
    <input type="text" id="userId" placeholder="Masukkan ID Pengguna (ex: A-101)">
    <input type="file" id="faceImage" accept="image/*">
    <button onclick="enrollFace()">Daftarkan Wajah</button>
    <p id="statusEnroll"></p>

    <script>
        // ⚠️ GANTI DENGAN URL PUBLIK DARI OUTPUT COLAB ANDA!
        const COLAB_URL = "https://c364a6719617.ngrok-free.app/enroll"; 

        // Fungsi konversi file menjadi Base64
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result.split(',')[1]); // Ambil hanya data base64
                reader.onerror = error => reject(error);
            });
        }

        async function enrollFace() {
            const userId = document.getElementById('userId').value;
            const fileInput = document.getElementById('faceImage');
            const statusElement = document.getElementById('statusEnroll');
            
            if (!userId || !fileInput.files.length) {
                statusElement.textContent = "ID Pengguna dan Gambar harus diisi!";
                return;
            }

            statusElement.textContent = "Memproses... Harap tunggu.";

            try {
                const base64Image = await fileToBase64(fileInput.files[0]);

                const response = await fetch(`${COLAB_URL}/enroll`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_id: userId,
                        image_base64: base64Image
                    })
                });

                const result = await response.json();
                
                if (result.status === 'success') {
                    statusElement.textContent = `✅ BERHASIL: ${result.message} Vektor disimpan di Firestore.`;
                } else {
                    statusElement.textContent = `❌ GAGAL: ${result.message}`;
                }

            } catch (error) {
                statusElement.textContent = `Terjadi kesalahan jaringan: ${error.message}`;
                console.error(error);
            }
        }
    </script>
</body>
</html>
